"use strict";class Cart{constructor(e){this.deleteButton=document.querySelector(e.deleteButton),this.activeKey="cart",this.container=document.querySelector(e.container),this.formBuy=document.querySelector(e.formBuy),this.formHold=document.querySelector(e.formHold),this.formMemo=document.querySelector(e.formMemo),this.total_carat=document.querySelector(e.total_carat),this.total_price=document.querySelector(e.total_price),this.total_stone=document.querySelector(e.total_stone),this.cart_length=document.querySelector(e.cart_length),this.init()}init(){return localStorage.setItem("cart",JSON.stringify([])),this.deleteSelected(),this.getFormData(this.formBuy,this),this.getFormData(this.formMemo,this),this.getFormData(this.formHold,this),this}debug(e=this){return this}unchecked(e){let t=JSON.parse(localStorage.getItem("cart"));t=t.filter((t=>{if(t!==e)return t})),localStorage.setItem("cart",JSON.stringify(t))}checked(e){const t=JSON.parse(localStorage.getItem("cart"));t.push(e),localStorage.setItem("cart",JSON.stringify(t))}removeByKey(e,t=document){e.map((e=>{t.querySelector(`#${e}`).closest(".result-section--element").remove()}))}deleteSelected(){this.deleteButton.addEventListener("click",(()=>{let e=JSON.parse(localStorage.getItem("cart"));this.removeByKey(e,this.container),localStorage.setItem("cart",JSON.stringify([])),0!==e.length&&(e=e.map((e=>e.replace("chb_",""))),ajax("delete_selected/",e,this.afterDelete,this))}))}afterDelete(e,t){t.total_price.textContent=e.total_price,t.total_carat.textContent=e.total_carat,t.total_stone.textContent=e.total_stone,t.cart_length.textContent=e.total_stone}afterSubmit(e,t){t.container.innerHTML="",t.total_price.textContent=0,t.total_carat.textContent=0,t.total_stone.textContent=0,void 0!==t.cart_length&&null!==t.cart_length&&t.cart_length.remove(),t.alert(e.alert,t.submitedForm)}alert(e,t){let r="";"success"==e?r='\n        <div class="alert alert-success border-0 shadow-sm" role="alert" id="responce_message">\n           <h5 class="h5">Success: your request was placed!</h5> <br>\n            You can view it at this link <a href="/orders/" class="fs-5 link">Orders</a>\n        </div>\n        ':"error"==e&&(r='\n        <div class="alert alert-danger border-0 shadow-sm" role="alert" id="responce_message">\n            <h5 class="h5">Error: The basket cannot be empty</h5>\n            You can get acquainted with the goods by following this link\n            <a href="/" class="fs-5 link">Diamonds</a>\n        </div>\n        ');const o=t.querySelector("#responce_message");null!=o&&o.remove();t.querySelector(".modal-body").insertAdjacentHTML("afterbegin",r)}getFormData(e,t){e.onsubmit=r=>{t.submitedForm=e,r.preventDefault();const o={};[...e.querySelectorAll("input, textarea")].map((e=>{("radio"==e.type&&e.checked||"radio"!==e.type)&&(o[e.name]=e.value)}));for(let e in o)"pay_within"!=e&&"p_ct_offer"!=e&&"total_price_offer"!=e||(o[e]=0);ajax("/orders/create/",o,this.afterSubmit,this)}}selected(){JSON.parse(localStorage.getItem("cart")).map((e=>this.container.querySelector(`#${e}`))).map((e=>{e.checked=!0,e.parentElement.classList.add("active")}))}}document.addEventListener("DOMContentLoaded",(()=>{const e=new Cart({deleteButton:"#delete-selected",container:"#cart-items",formBuy:"#form-buy",formMemo:"#form-memo",formHold:"#form-hold",total_price:"#total_price",total_carat:"#total_carat",total_stone:"#total_stone",cart_length:"#cart_length"}).init();new ElementsControl({manager:".result__item-list",managed:".result__drop-down"}).toggler({single:!0,notThis:".label-result"});new ElementsControl({manager:".btn-more--info",managed:".body-more--info"}).toggler({single:!0});new ElementsControl({manager:'[data-io-label="diamonds-item"]',managed:".checkbox-results"}).label(e.checked,e.unchecked),function(){const e=document.querySelector("#hours-item"),t=e.querySelector("#hold-hours--title"),r=e.querySelectorAll(".hold-hours__select"),o=e.querySelector("#hold-hours--option");e.addEventListener("click",(()=>{e.classList.toggle("active")})),r.forEach((e=>{e.addEventListener("click",(()=>{let r=e.textContent;t.textContent=r,o.value=r}))}))}();new ScrollFix({container:"#cart-items"});new SortSystem({viewContainer:"#cart-items",simpleContainer:"#cart_simple_sort",simpleItems:"[data-io-simple-sort]",advancedContainer:"#cart-sort-modal",advancedDragBox:"#cart-name-priority",advancedOffBox:"#cart-name-sort",advancedItems:"[data-io-advanced-sort]",plusItems:".fa-plus",angleItems:".fa-angle-down",url:"sort/",extention:e}).init()}));